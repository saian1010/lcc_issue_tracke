{% extends "userbase.html" %}
{% set active_page = 'issues' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">Issue List</h2>
    
    <!-- Search Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="GET">
                <!-- PC View -->
                <div class="d-none d-md-block">
                    <div class="row g-2">
                        <div class="col-md-6">
                            <input type="text" 
                                   class="form-control" 
                                   name="search_name" 
                                   placeholder="Search by issue name"
                                   value="{{ request.args.get('search_name', '') }}">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" name="status">
                                <option value="">All Status</option>
                                <option value="new" {% if request.args.get('status') == 'new' %}selected{% endif %}>New</option>
                                <option value="open" {% if request.args.get('status') == 'open' %}selected{% endif %}>Open</option>
                                <option value="stalled" {% if request.args.get('status') == 'stalled' %}selected{% endif %}>Stalled</option>
                                <option value="resolved" {% if request.args.get('status') == 'resolved' %}selected{% endif %}>Resolved</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </div>
                        <div class="col-md-2">
                            <a href="{{ url_for('list_issues') }}" class="btn btn-outline-secondary w-100">Reset</a>
                        </div>
                    </div>
                </div>

                <!-- Mobile View -->
                <div class="d-md-none">
                    <div class="row g-2">
                        <div class="col-12 mb-2">
                            <input type="text" 
                                   class="form-control" 
                                   name="search_name" 
                                   placeholder="Search by issue name"
                                   value="{{ request.args.get('search_name', '') }}">
                        </div>
                        <div class="col-8">
                            <select class="form-select" name="status">
                                <option value="">All Status</option>
                                <option value="new" {% if request.args.get('status') == 'new' %}selected{% endif %}>New</option>
                                <option value="open" {% if request.args.get('status') == 'open' %}selected{% endif %}>Open</option>
                                <option value="stalled" {% if request.args.get('status') == 'stalled' %}selected{% endif %}>Stalled</option>
                                <option value="resolved" {% if request.args.get('status') == 'resolved' %}selected{% endif %}>Resolved</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <button type="submit" class="btn btn-primary w-100">Search</button>
                        </div>
                    </div>
                </div>

                <!-- New Issue Button -->
                <div class="text-end mt-3">
                    <a href="{{ url_for('create_issue') }}" class="btn btn-success">New Issue</a>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive mb-3">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Summary</th>
                    <th>Status</th>
                    <th>Created By</th>
                    <th>Created At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            {% for issue in issues %}
                <tr>
                    <td>{{ issue.issue_id }}</td>
                    <td>{{ issue.summary }}</td>
                    <td>
                        <span class="badge bg-{{ {
                            'new': 'info',
                            'open': 'primary',
                            'stalled': 'warning',
                            'resolved': 'success'
                        }[issue.status] }}">{{ issue.status }}</span>
                    </td>
                    <td>{{ issue.username }}</td>
                    <td>{{ issue.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <a href="{{ url_for('view_issue', issue_id=issue.issue_id) }}" class="btn btn-sm btn-primary">View</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if total_pages > 1 %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item {{ 'disabled' if current_page == 1 }}">
                <a class="page-link" href="{{ url_for('list_issues', page=current_page-1, search_name=search_name, status=status_filter) if current_page > 1 else '#' }}">Previous</a>
            </li>
            
            {% for page_num in range(1, total_pages + 1) %}
            <li class="page-item {{ 'active' if page_num == current_page }}">
                <a class="page-link" href="{{ url_for('list_issues', page=page_num, search_name=search_name, status=status_filter) }}">{{ page_num }}</a>
            </li>
            {% endfor %}
            
            <li class="page-item {{ 'disabled' if current_page == total_pages }}">
                <a class="page-link" href="{{ url_for('list_issues', page=current_page+1, search_name=search_name, status=status_filter) if current_page < total_pages else '#' }}">Next</a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %} 